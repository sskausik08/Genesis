\section{Synthesis of Operator Policies}
\label{sec:optimization}

We now describe how to extend \Name's synthesis to support various
operator policies.  We describe \Name can support
hard capacity constraints and
optimization objectives pertaining to traffic engineering using
 linear rational arithmetic (LRA) and linear
optimization objectives in SMT. We conclude by describing how \Name can be
extended to allow operators to handle datacenter network failures in a
graceful policy-compliant manner.

\subsection{Link and Switch Table Capacity} \label{sec:linkcap}
%%\subsubsection{Link Capacity Constraints} 
For a link capacity policy on the link $sw_1 \rightarrow sw_2: \omega$, 
\name must ensure that the sum of traffic rates of packet
classes using link $sw_1 \rightarrow sw_2$
does not exceed $\omega$. 
As input, we have the traffic rates $\sigma(pc)$ of
each of the packet classes. The constraints added to $\Psi$ are:
\begin{equation}
 \sum_{\forall pc} \texttt{ite}(Fwd(sw_1,sw_2, pc), \sigma(pc), 0) \leq \omega .
\end{equation}
If a class $pc$ uses link $sw_1 \rightarrow sw_2$, then $(sw_1,sw_2, pc) \in Fwd$
and $\sigma(pc)$ is added in the utilization of the link. \\
\noindent A switch table policy $sw : \gamma$ specifies that the number of forwarding 
rules on $sw$ must not exceed $\gamma$. Similar to the link capacity policy,
the constraints ensure the count of all packet classes which traverse $sw$ (each 
will require a forwarding rule) is $\leq \gamma$ :
\begin{equation}
\sum_{\forall pc} \texttt{ite}(~\exists k. Reach(sw,pc,k), 1, 0)  \leq \gamma.
\end{equation}



%% While SMT solvers provide support for different theories like SAT and
%% LRA to express various policies as seen in \secref{sec:synthesisalgo},
%% operators additionally need to optimize different metrics of the
%% network.


\subsection{Traffic Engineering}
While the above capacity policies can be used to perform a strict form
of traffic engineering (TE) in terms of adhering to link bandwidths,
it is often more useful to balance traffic across links because a
link failure will affect fewer flows when the flows are spread evenly
across the network.  To this end, network operators often impose
traffic engineering objectives such as minimizing the total link
utilization or the maximum link utilization. 
\name performs coarse-grained TE, 
e.g., given information about diurnal traffic patterns, 
expected load (such as background systems workloads), 
plan how to route flows according to a global objective.
%% useful in balancing traffic across links,
%% and a link failure will affect lesser number of flows when the flows
%% are spread evenly across the network.

\minisection{Min-tot TE}
To perform traffic engineering, link capacities of the network $C(sw_1, sw_2)$ and traffic 
rates of the packet classes $\sigma(pc)$ are specified as input to \name (we assume a single
path for a packet class). The utilization 
of a link $U(sw_1, sw_2)$ is defined as the ratio of total traffic flowing through the link to the 
link capacity, and encoded using the theory of linear rational arithmetic as:
\begin{equation}
U(sw_1, sw_2) = \frac{\sum_{\forall pc} \texttt{ite}(Fwd(sw_1,sw_2, pc), \sigma(pc), 0)} {C(sw_1, sw_2)}
\end{equation}
The following objective minimizes the total link utilization:
\begin{equation}
	\texttt{minimize}\ \sum_{\forall sw_1, sw_2} U(sw_1, sw_2)
\end{equation}

\minisection{Min-max TE}
To encode the TE objective of minimizing the maximum link utilization, we define
a variable $maxU$ which represents the maximum
link utilization. 
The constraints added to ensure that $maxU$ is greater than or equal to all 
individual link utilizations:
\begin{equation} \label{eq:maxu}
\forall sw_1, sw_2.\ \ maxU \geq U(sw_1, sw_2)
\end{equation} 
We then impose the following objective:
\begin{equation}
		\texttt{minimize}\ maxU
\end{equation}

\minisection{Multipath TE}
\name can support multipath-TE: for a packet class $pc$, we can create $k$ 
subclasses and split traffic of $pc$ among the $k$ paths adhering to 
the global objective. However, this 
requires a static split of traffic among the subclasses. By adding isolation
policies to the $k$ subclasses, we can split traffic 
of $pc$ along edge-disjoint paths. Furthermore, \name can be used for other
quantitative objectives like minimizing total latency and load balancing
traffic across middleboxes by using an encoding similar 
to the one presented in this section.

