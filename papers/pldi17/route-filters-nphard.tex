\begin{proof}
We show that the decision version of the minimum 
vertex cover problem, i.e., there exists a vertex cover
of size $ \leq k$, which is NP-complete, 
reduces to finding a set of route filters of size $ \leq k$ \
and OSPF weights for a network with only one domain. 
The latter is also in NP, so after the reduction we 
can conclude that it is also NP-complete.

Let $G = (V,E)$ be an instance of the 
minimum vertex cover problem. A set of
vertices $VC \subseteq V$ is the vertex cover
if $\forall (v_1, v_2) \in E. ~v_1 \in VC \vee v_2 \in VC$. 

We now show how to construct a topology $T=(S,L)$ 
and a corresponding set of paths $P$ that can be 
induced by route filter set $R$ such that $|R| \leq k$  
iff the corresponding $VC(R)$ is a vertex cover of 
the graph $G$ and $|VC(R)| \leq k$.

For every vertex $v \in V$: add two vertices $r_v^1$ 
and $r_v^2$ to $S$ and a directed link $r_v^1 \rightarrow r_v^2$ to $L$. 
We also assign a destination host $d_v$ for each vertex $v$. 

For every edge $(u,v) \in E$: add two vertices $s_{uv}$
and $t_{uv}$ to $S$. Add edges
connecting $s_{uv} \rightarrow s_{u}^1$, $s_{uv} \rightarrow s_{v}^1$,
$s_{u}^2 \rightarrow t_{uv}$ and $s_{v}^2 \rightarrow t_{uv}$. \Cref{fig:rfcomplexity} illustrates this construction.
\begin{figure}[H]
	\centering
	\begin{tikzpicture}[shorten >=0.5pt,node distance=1.5cm,on grid,auto,
	square/.style={regular polygon,regular polygon sides=4}] 
	\node[state] at (0,0) (s)  {$s_{uv}$}; 
	\node[state] at (2,-0.75) (v1)  {$r_v^1$}; 
	\node[state] at (4,-0.75) (v2)  {$r_v^2$};
	\node[state] at (2,0.75) (u1)  {$r_u^1$}; 
	\node[state] at (4,0.75) (u2)  {$r_u^2$}; 
	\node[state] at (6,0) (t) {$t_{uv}$};
	\node[state] (s1) [below left=of v1] {$s_{vw}$}; 	
	\node[state] (t1) [below right=of v2] {$t_{vw}$}; 	
	\path[->] 
	(s) edge  node {} (v1)
	edge  node {} (u1)
	edge [blue, dashed, bend right=45] node {} (t)
	edge [red, dashed, bend left=45] node {} (t)
	(u1) edge node {} (u2)
	(u2) edge node {} (t)
	(v1) edge node {} (v2)
	(v2) edge node {} (t)
	edge node {} (t1)
	(s1) edge node {} (v1);
	\path[-] (s1) edge node[above] {} +(1,-0.1);
	\path[-] (t1) edge node[above] {} +(-1,-0.1);
	\end{tikzpicture}
	\caption{Construction}
	\label{fig:rfcomplexity}
\end{figure}
If there was another edge $(v,w) \in E$, then
$s_{vw}$ has an edge connecting to $r_v^1$ and
$r_v^2$ has an edge connecting to $t_{vw}$ (shown
in \Cref{fig:rfcomplexity}). $s_{vw}$ will also 
have an edge to $s_w^1$ and similarily from $s_w^2$ to $t_{uw}$
as per the construction outlined above.

For each edge $(u,v) \in E$, we add two paths in $P$: 
$s_{uv} \rightarrow r_u^1 \rightarrow r_u^2 \rightarrow t_{uv}$
for destination host $d_v$ and 
$~s_{uv} \rightarrow r_v^1 \rightarrow r_v^2 \rightarrow t_{uv}$ 
for destination host $d_u$.
(dashed paths in \Cref{fig:rfcomplexity}). 

We now prove that if there exists a set of route filters
$R$ such that $|R| \leq k$ such that the resulting configurations
forwards traffic along $P$, then there exists a vertex cover $VC$
of $G$ such that $|VC| \leq k$. 

For each route filter $r \in R$, one of its endpoints 
has to be either $r_v^1$ or $r_v^2$, corresponding
to some vertex $v \in V$ (structure of topology $T$). 
We construct a set $VC(R)$ by adding the vertex $v$ 
based on the endpoints of each route filter $r \in R$.
To show that $VC(R)$ is a vertex cover of $G$, we first
prove \Cref{lemma:diamond}.

\begin{lemma} \label{lemma:diamond}
	 For each diamond formed by the input paths, atleast 1 
	 route filter on one of the edges of the paths of the diamond 
	 is required to find a valid solution to the
	 OSPF edge weights.  
\end{lemma}

\begin{proof}
Consider the following diamond % in \Cref{fig:diamond}
constructed by paths $p_1$: $s \rightarrow r_1 \rightarrow t$ 
for destination $d_1$ and $p_2$:$s \rightarrow r_2 \rightarrow t$ 
for destination $d_2$. Let us assume there exists a solution 
for the OSPF edge weights without any route filters. 

As we will describe in \Cref{sec:intra-synthesis}, 
to ensure $p_1$ is the shortest path from $s$ to $t$, the following
linear inequality is added to ensure $p_1$ is shorter than the
path from $s$ to $t$ via $r_2$: 
\begin{equation} \label{eq:diamond1}
	e(s,r_1) + e(r_1, t) < e(s, r_2) + e(r_2,t)
\end{equation}
$e(s,r_1)$ denotes the weight of edge $s \rightarrow r_1$.
Since $p_2$ is also the shortest path from $s$ 
to $t$, the linear inequality added is:
\begin{equation}  \label{eq:diamond2}
e(s,r_2) + e(r_2, t) < e(s, r_1) + e(r_1,t)
\end{equation}
Since there are no route filters on the edges
of $p_1$ and $p_2$, none of the above equations are 
eliminated (\Cref{sec:routefilter}). 
Adding equations \ref{eq:diamond1} and  \ref{eq:diamond2} 
yields the inequality $0 < 0$, which is inconsistent 
and therefore, no solution to 
the edge weights exists for this system of equations, 
which contradicts our assumption. Therefore,
for each diamond formed by the input paths, atleast 1 
route filter on one of the edges of the paths of the diamond 
is required to find a valid solution to the
OSPF edge weights.  
\end{proof}

For every edge $(u,v) \in E$, the constructed paths from 
$s_{uv}$ to $t_{uv}$ form a diamond. Thus, by lemma 1, 
the diamond corresponding to each edge in $G$ 
requires atleast one route filter to eliminate
the inconsistency caused by the diamond, thus, one 
of vertices $\{u,v\}$ will be in $VC(R)$, and edge $(u,v)$
is covered. Thus, if $R$ eliminates all diamond inconsistencies
to find a solution to the OSPF weights, the corresponding set
$VC(R)$ covers all edges in $E$. Therefore, $VC(R)$ is a vertex
cover. 

Thus, by finding a set of route filters $R$ such that $|R| \leq k$
such that all the diamond inconsistencies are eliminated, and there
exists OSPF weights $W$ such that the configurations forward traffic
along $P$, we can find a vertex cover $VC$ for graph $G$ such that
$|VC| \leq k$. 

This transformation is polynomial, the constructed 
network topology $T$ has $2|V| + 2|E|$ nodes, 
$|V| + 4|E|$ links and $2|E|$ paths. Therefore, OSPF
configuration synthesis with number of route filters $\leq k$ is
NP-complete. Thus, OSPF synthesis with minimal number of 
route filters is NP-hard. 
\end{proof}
