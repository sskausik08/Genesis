%!TEX root = paper.tex
\begin{proof}
We show that the decision version of the minimum 
vertex cover problem, i.e., there exists a vertex cover
of size $ \leq k$, which is NP-complete, 
reduces to finding a set of static routes 
of size $ \leq k$ \
and OSPF weights for a network with only one domain. 
The latter is also in NP, so after the reduction we 
can conclude that it is also NP-complete.

Let $G = (V,E)$ be an instance of the 
minimum vertex cover problem. A set of
vertices $VC \subseteq V$ is the vertex cover
if $\forall (v_1, v_2) \in E. ~v_1 \in VC \vee v_2 \in VC$. 

We now show how to construct a topology $T=(R,L)$ 
and a corresponding set of paths $\Pi$ that can be enforced 
by configuration C which requires static routes $SR$ such that $|SR| \leq k$  
if and only if the corresponding $VC(SR)$ is a vertex cover of 
the graph $G$ and $|VC(SR)| \leq k$.

\paragraph{Construction.}
For every vertex $v \in V$: add a vertex $r_v$.
For every edge $(u,v) \in E$: add two vertices $s_{uv}$
and $t_{uv}$ to $R$. Add edges
connecting $s_{uv} \rightarrow r_{u}$, $s_{uv} \rightarrow r_{v}$,
$r_{u} \rightarrow t_{uv}$ and $r_{v} \rightarrow t_{uv}$. 
\Cref{fig:rfcomplexity} illustrates this construction.
\begin{figure}[H]
	\centering
	\begin{tikzpicture}[shorten >=0.5pt,node distance=1.5cm,on grid,auto,
	square/.style={regular polygon,regular polygon sides=4}] 
	\node[state] at (0,0) (s)  {$s_{uv}$}; 
	\node[state] at (3,-1) (v)  {$r_v$}; 
	\node[state] at (3,1) (u)  {$r_u$}; 
	\node[state] at (6,0) (t) {$t_{uv}$}; 	
	\node[state] (s1) [below=of s] {$s_{vw}$}; 	
	\node[state] (t1) [below=of t] {$t_{vw}$}; 	
	\path[-] 
	(s) edge  node {} (v)
	edge  node {} (u)
	edge [blue, dashed, bend right=40] node {} (t)
	edge [red, dashed, bend left=40] node {} (t)
	(u) edge node {} (t)
	(v) edge node {} (t)
	edge node {} (t1)
	edge node {} (s1);
	\path[->]
	(s)
	edge [blue, dashed, bend right=40] node {} (t)
	edge [red, dashed, bend left=40] node {} (t);
%	\path[-] (s) edge node[above] {} +(1,-0.1);
%	\path[-] (t1) edge node[above] {} +(-1,-0.1);
	\end{tikzpicture}
	\caption{Construction for reduction to Vertex Cover.}
	\label{fig:rfcomplexity}
\end{figure}
If there is another edge $(v,w) \in E$, then
$s_{vw}$ and $t_{vw}$ have an edge connecting to $r_v$ (shown
in \Cref{fig:rfcomplexity}). 

For each edge $(u,v) \in E$, we add two paths in $\Pi$: 
$s_{uv} \rightarrow r_u \rightarrow t_{uv}$
for destination host $d_u$ and 
$~s_{uv} \rightarrow r_v \rightarrow t_{uv}$ 
for destination host $d_v$.
(dashed paths in \Cref{fig:rfcomplexity}). 

We now prove that if there exists a set of static routes
$SR$ such that $|SR| \leq k$ such that the resulting configurations
are path-compliant for $\Pi$, then there exists a vertex cover $VC$
of $G$ such that $|VC| \leq k$. 

For each static route $sr \in SR$, the static route
has to be placed at the source, either going to $r_u$
or $r_v$ (structure of topology $T$). 
We construct a set $VC(SR)$ by adding the vertex $v$
based on the endpoints of each static route $sr \in SR$.
To show that $VC(SR)$ is a vertex cover of $G$, we first
prove \Cref{lemma:diamond}.

\begin{lemma} \label{lemma:diamond}
	 For each diamond formed by the input paths, atleast 1 
	 static route on one of the edges of the paths of the diamond 
	 is required to find a valid solution to the
	 OSPF edge weights.  
\end{lemma}

\begin{proof}
Given two paths $\pi_1$ and $\pi_2$ for destinations 
$d_u$ and $d_v$, we define these paths form a diamond
if these paths intersect at two routers ($s_{uv}$ and $t_{uv}$) 
without any common router in between. 
Consider the following diamond % in \Cref{fig:diamond}
constructed by paths $\pi_1$: $s_{uv} \rightarrow r_u \rightarrow t_{uv}$ 
for destination $d_u$ and $\pi_2$: $s_{uv} \rightarrow r_v \rightarrow t_{uv}$ 
for destination $d_v$. Let us assume there exists a solution 
for the OSPF edge weights without any static routes. 

We add the following inequality 
to make $\pi_1$ is the shortest 
path from $s_{uv}$ to $t_{uv}$ by
ensuring
 $\pi_1$ is shorter than the
path from $s_{uv}$ to $t_{uv}$ via $r_v$: 
\begin{equation} \label{eq:diamond1}
	W(s_{uv},r_u) + W(r_u, t_{uv}) < W(s_{uv}, r_v) + W(r_v,t_{uv})
\end{equation}
Since $\pi_2$ is also the shortest path from $s_{uv}$ 
to $t_{uv}$, the linear inequality added is:
\begin{equation}  \label{eq:diamond2}
W(s_{uv},r_v) + W(r_v, t) < W(s_{uv}, r_u) + W(r_u,t_{uv})
\end{equation}
Since there are no static routes on the edges
of $\pi_1$ and $\pi_2$, none of the above equations are 
eliminated. 
Adding equations \ref{eq:diamond1} and  \ref{eq:diamond2} 
yields the inequality $0 < 0$, which is inconsistent 
and therefore, no solution to 
the edge weights exists for this system of equations, 
which contradicts our assumption. Therefore,
for each diamond formed by the input paths, atleast 1 
static route on one of the edges of the paths of the diamond 
is required to find a valid solution to the
OSPF edge weights.  
\end{proof}

For every edge $(u,v) \in E$, the constructed paths from 
$s_{uv}$ to $t_{uv}$ form a diamond. Thus, by Lemma~\ref{lemma:diamond}, 
the diamond created by the paths corresponding to each edge in $G$ 
requires atleast one static route to eliminate
the inconsistency caused by the diamond. If a static route's endpoints
contains $r_u$, we put $u$ in $VC(SR)$ and similarily for $r_v$. 
Edge $(u,v)$ is covered since atleast one static route is added,
thus, atleast one of $\{u,v\}$ is in $VC(SR)$.  
Thus, if $SR$ eliminates all diamond inconsistencies
to find a solution to the OSPF weights, the corresponding set
$VC(SR)$ covers all edges in $E$. Therefore, $VC(SR)$ is a vertex
cover. 

Thus, by finding a set of static routes $SR$ such that $|SR| \leq k$
such that all the diamond inconsistencies are eliminated, and there
exists OSPF weights $W$ such that the configurations forward traffic
along $\Pi$, we can find a vertex cover $VC$ for graph $G$ such that
$|VC| \leq k$. 

This transformation is polynomial, the constructed 
network topology $T$ has $|V| + 2|E|$ nodes, 
$4|E|$ links and $2|E|$ paths. Therefore, OSPF
configuration synthesis with number of static routes $\leq k$ is
NP-complete. Thus, OSPF synthesis with minimal number of 
static routes is NP-hard. 
\end{proof}
