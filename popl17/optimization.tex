\section{Synthesis with Optimization Objectives}
We describe two applications paramount to network management:
traffic engineering and network repair, which can be tackled using
extensions of solvers: SMT with linear optimization objectives and MaxSMT ~\cite{maxsmt}.
\subsection{Traffic Engineering}
While the link capacity policies described in \Cref{sec:linkcap} can
be used to perform a strict form of traffic engineering(TE) in terms of 
adhering to link bandwidths, support for objectives
like minimizing the maximum link utilization and minimizing total link utilization
is highly \emph{desirable}.

\paragraph{Min-tot TE}
To perform traffic engineering, link capacities of the network $C(sw_1, sw_2)$ and traffic 
rates of the packet classes $T(pc)$ are specified as input to \name (we assume a single
path for a packet class). The utilization 
of a link $U(sw_1, sw_2)$ is defined as the ratio of total traffic flowing through the link to the 
link capacity, and encoded using the theory of linear rational arithmetic as:
\begin{equation}
U(sw_1, sw_2) = \frac{\sum_{\forall pc} \texttt{ite}(Fwd(sw_1,sw_2, pc), T(pc), 0)} {C(sw_1, sw_2)}
\end{equation}
The objective for minimizing total link utilization is as follows:
\begin{equation}
	\texttt{minimize}\ \sum_{\forall sw_1, sw_2} U(sw_1, sw_2)
\end{equation}
\paragraph{Min-max TE}
To encode the TE objective of minimizing the maximum link utilization, we define
a variable $maxU$, and constraints to ensure that $maxU$ is greater than or equal to all 
individual link utilisations, and the objective: 
\begin{equation} \label{eq:maxu}
\forall sw_1, sw_2.\ \ maxU \geq U(sw_1, sw_2)
\end{equation} 
\begin{equation}
		\texttt{minimize}\ maxU
\end{equation}
While $maxU$ can be set to a large value trivially to satisfy \Cref{eq:maxu}
, since the objective is to minimize $maxU$, it will be set to the actual
minimized maximum link utilization. Using an encoding similar to the one presented in this section, \name can be used for other objectives like minimizing total latency and load balancing
traffic across the network middleboxes.

\subsection{Network Repair}
While policy-compliance is a major requirement in a network management system,
another important consideration is the frequent occurence of failures (switches, links etc.),
which require recomputation of paths compliant to the policies for the modified topology. Operators also have to accomodate incremental changes in tenants/policies frequently. 
While a naive approach is to use \name to resynthesize the modified instance,
the new solution may be drastically different from the original configuration, incurring a
large overhead of installing the new configuration. Thus, operators
need a \emph{network repair} mechanism which can transition with minimal
overhead from the current
forwarding configuration to a policy-compliant one. 
\name can also be used to
port existing non-policy compliant configurations deployed in a network to
one which satisfies a set of policies.

We extend \name's synthesis algorithm for performing
minimal network repair using MaxSMT.  
Formally, the weighted MaxSMT problem is as follows: given a set
of formulas $\Psi_0, \Psi_1, \ldots \Psi_n$ with associated 
weights $w_1, \ldots w_n$, find a subset $M \subseteq \{1, \ldots n\}$
such that 
\begin{enumerate}
	\item $\Psi_0 \wedge \bigwedge_{i \in M} \Psi_i$ is satisfiable.
	\item The \emph{award} $\sum_{i \in M} w_i$  is maximized.
\end{enumerate}
The constraints $\Psi_1, \ldots \Psi_n$ denote \emph{soft} constraints, and
the weights $w_i$ encodes the award for including $\Psi_i$ in the satisfying
assignment. 
%The basic intuition is that
%we add the existing configuration as \emph{soft} constraints to the set of \emph{hard} 
%policy constraints. The solver would return a solution which \emph{maximizes} the 
%number of satisfied soft constraints (the older configuration),
%thus resulting in a new policy-compliant forwarding 
%configuration with minimal 
%number of changes from the older one and reducing the overhead of
%updating the forwarding rules in the network.  

We reduce network repair to a MaxSMT problem
such that 
the number of switches on which rules needs to be updated is minimized.
 Let
the policy constraints generated by \name be $\Psi_0$, and the present 
configuration is $(\overline{Fwd})$ which does not satisfy $\Psi_0$. The 
objective is to find new $Fwd$ which satisfies $\Psi_0$ such that the number of \emph{preserved} switches 
is maximized. If the rules on switch $sw_i$ is preserved, then $Fwd$ and $\overline{Fwd}$ have the same forwarding rules for all packet classes which
traverse through $sw_i$. The MaxSMT constraints are described as follows:
\begin{equation}
	\Psi_{sw_i} =  
	  \bigvee_{\mathclap{\substack{\forall sw_j, pc \\
			  		(sw_i, sw_j, pc) \in \overline{Fwd}}}} Fwd(sw_i, sw_j, pc) 
			~~~~~~~~~~~ 
			w_{sw_i}= 1
\end{equation}
With $\Psi_0, \Psi_{sw_1}, \ldots, \Psi_{sw_n}$  and associated weights 
$w_{sw_1}, \ldots w_{sw_n}$
to a MaxSMT solver, we can synthesize a new forwarding configuration 
which \emph{minimizes} the number of switches which have to be changed.
The weights can be altered for different priorities for different switches. Alternate
repair objectives like minimizing number of changed forwarding rules (instead of 
switches) can be expressed similarly.

%\name is provided the policies
%and the current forwarding rules $(\overline{Fwd})$ as input. The policy constraints are added as hard
%constraints as described in the earlier sections. To maximize the number of unchanged
%switches, we add \emph{soft} constraints for each switch $sw_1$ of uniform weight as follows:
%Thus, the new forwarding rules $Fwd$ will maximise the number of unchanged
%switch rules in $\overline{Fwd}$, because the constraint will be unsatisfied if a rule on the
%switch changes. 


 







 